import{_ as D,T as H,U as P,r as w,G as I,b as R,d as U,W as b,X as G,Y as V,Z as W,$,a0 as z,a1 as y,o as d,h as u,F as j,l as C,i as l,j as k,x as J,a2 as Z,p as K,m as Q,a3 as ee}from"./index.873cfa32.js";const M=v=>(K("data-v-76055771"),v=v(),Q(),v),te={class:"myMovies-wrapper"},se=M(()=>l("div",{class:"myMovies-wrapper-title"},[l("h3",null,"\u6211\u7684\u7247\u55AE")],-1)),oe={key:0},ie=["data-movie-index"],ae=["data-src"],re=["src"],ne={key:1,style:{width:"100%"}},le=M(()=>l("h3",{style:{"font-size":"24px"}},"\u5C1A\u672A\u6DFB\u52A0\u96FB\u5F71\u5230\u6211\u7684\u7247\u55AE",-1)),ce=[le],de={key:1},ue={class:"movies-content INITing"},fe={class:"movies-list"},ve={class:"movie-item"},me=["src"],ge={id:"triggerModal",ref:"triggerModal"},pe={setup(v){const O=H(),{userData:m,myMovies:E}=P(O);let x=null;const f=w([]),g=w(null),c=w(!1);I(m,e=>{e&&!c.value&&(console.log("v",e),p(e.movies))}),I(E,e=>{e&&c.value&&p(e)}),m.value.movies?p(m.value.movies):setTimeout(()=>{c.value=!0},1500);function p(e=""){if(!e)return c.value=!0;if(e=JSON.parse(e),!e.length){f.value=[],c.value=!0;return}console.log("movies",e);let a=[];e.forEach(t=>{let s;t.toString().includes("n")?(t=t.replace("n",""),s=R(t)):s=U(t),a.push(s)}),Promise.all(a).then(async t=>{let s=[];t.forEach(o=>{s.push(o.data)}),f.value=s.map(o=>{let r=o.id,i=!!e.find(_=>_.toString().includes(r));return{id:o.id,url:o.backdrop_path,title:o.title?o.title:o.name,score:o.vote_average,movie:o,isNetflix:i}}),c.value=!0,await b(),L()}).catch(()=>{c.value=!0})}function L(){const e=g.value.querySelectorAll("a.movie-item"),a={root:document.querySelector(".myMovies-wrapper"),rootMargin:"100px"},t=new IntersectionObserver(s=>{s.forEach(o=>{if(o.isIntersecting){let r;o.target.dataset.src?r=`url(https://image.tmdb.org/t/p/w300${o.target.dataset.src})`:r=`url(${ee})`,o.target.style.backgroundImage=r,setTimeout(()=>{o.target.classList.add("active")},800),t.unobserve(o.target)}})},a);e.forEach(s=>t.observe(s))}let n=null;G(()=>n==null?void 0:n()),V(()=>{S()});function S(){let e=g.value;b(()=>{e.querySelectorAll(".movies-list").forEach(t=>{t.addEventListener("mouseover",T),t.addEventListener("mouseleave",N)})}),document.body.addEventListener("mouseover",X)}function T(e){x=setTimeout(()=>{var t,s;const a=e.target.parentElement;if((t=a==null?void 0:a.dataset)!=null&&t.movieIndex){let o=a.dataset.movieIndex,r=f.value[o];const{x:i,y:_,width:h,height:F}=q(e.target,"center"),A=(s=document.body.getBoundingClientRect())==null?void 0:s.width;B({x:i,y:_,width:h,height:F,movie:r,isFirstItem:i-h<0,isLastItem:i+h>A})}},500)}function N(){clearTimeout(x)}function X(e){let a=e.target,t=document.querySelector("#triggerModal");if(!!t&&a!==t&&!t.contains(e.target)){let s=t.querySelector(".previewMovie-wrapper");s&&(s.classList.remove("active"),setTimeout(()=>{n==null||n()},295))}}const{appContext:Y}=W(),B=async e=>{n==null||n(),n=$({el:"#triggerModal",component:(await z(()=>import("./PreviewSlideMovie.eeed8fd8.js"),["assets/PreviewSlideMovie.eeed8fd8.js","assets/PreviewSlideMovie.38a5395e.css","assets/index.873cfa32.js","assets/index.dba418e2.css"])).default,props:{key:e.movie.id,movie:e.movie,left:e.x,top:e.y,width:e.width,height:e.height,imgurl:e.movie.url,imgbox:y,isFirstItem:e.isFirstItem,isLastItem:e.isLastItem},appContext:Y})};function q(e,a){const{top:t,left:s,width:o,height:r}=e.getBoundingClientRect();let i;switch(a){case"top left":i={x:s+window.pageXOffset,y:t+window.pageYOffset};break;case"top center":i={x:s+o/2+window.pageXOffset,y:t+window.pageYOffset};break;case"top right":i={x:s+o+window.pageXOffset,y:t+window.pageYOffset};break;case"center left":i={x:s+window.pageXOffset,y:t+r/2+window.pageYOffset};break;case"center":i={x:s+o/2+window.pageXOffset,y:t+r/2+window.pageYOffset};break;case"center right":i={x:s+o+window.pageXOffset,y:t+r/2+window.pageYOffset};break;case"bottom left":i={x:s+window.pageXOffset,y:t+r+window.pageYOffset};break;case"bottom center":i={x:s+o/2+window.pageXOffset,y:t+r+window.pageYOffset};break;case"bottom right":i={x:s+o+window.pageXOffset,y:t+r+window.pageYOffset};break}return i.width=o,i.height=r,i}return(e,a)=>(d(),u("div",te,[se,c.value?(d(),u("div",oe,[f.value.length?(d(),u("div",{key:0,class:"movies-content",ref_key:"moviesEl",ref:g},[(d(!0),u(j,null,C(f.value,(t,s)=>(d(),u("div",{class:"movies-list",key:s,"data-movie-index":s},[l("a",{class:"movie-item","data-src":t.url},[l("img",{src:k(y),alt:""},null,8,re)],8,ae)],8,ie))),128))],512)):(d(),u("div",ne,ce))])):(d(),u("div",de,[l("div",ue,[l("div",fe,[l("a",ve,[l("img",{src:k(y),alt:""},null,8,me)])])])])),l("div",ge,null,512),J(Z,{ref:"modal"},null,512)]))}};var he=D(pe,[["__scopeId","data-v-76055771"]]);export{he as default};
//# sourceMappingURL=MyMovies.18138f1f.js.map
