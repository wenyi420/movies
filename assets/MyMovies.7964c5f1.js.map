{"version":3,"file":"MyMovies.7964c5f1.js","sources":["../../src/views/MyMovies.vue"],"sourcesContent":["<script setup>\r\nimport { ref, watch } from \"vue\";\r\nimport { useUserStore } from \"@/stores/user.js\";\r\nimport { storeToRefs } from \"pinia\";\r\nimport { apiGetMovieDetail, apiGetNexflixDetail } from \"@/apis/movie.js\";\r\nimport noImg from \"@/assets/image/noImg.jpg\";\r\nimport movieImg from \"@/assets/image/LoginedMovieSlideImgBox.png\";\r\nimport MovieModal from \"@/components/Global/Modal/MovieModal.vue\";\r\nimport MovieItem from \"@/components/MovieItem.vue\";\r\nimport SkeletonItem from \"@/components/SkeletonItem.vue\";\r\n\r\nconst store = useUserStore();\r\nconst { userData, myMovies } = storeToRefs(store);\r\n\r\nconst movieList = ref([]);\r\nconst moviesEl = ref(null);\r\nconst isINITed = ref(false);\r\n\r\n// watch 負責處理直接在此頁 render 而非從其他頁過來時使用\r\nwatch(userData, (v) => {\r\n  if (v && !isINITed.value) {\r\n    console.log(\"v\", v);\r\n    INITMyMovies(v.movies);\r\n  }\r\n});\r\n\r\nwatch(myMovies, (v) => {\r\n  if (v && isINITed.value) {\r\n    INITMyMovies(v);\r\n  }\r\n});\r\n\r\nif (userData.value.movies) {\r\n  INITMyMovies(userData.value.movies);\r\n} else {\r\n  const closeLoadingTime = 10000;\r\n  setTimeout(() => {\r\n    isINITed.value = true;\r\n  }, closeLoadingTime);\r\n}\r\n\r\nfunction INITMyMovies(movies = \"\") {\r\n  if (!movies) return (isINITed.value = true);\r\n\r\n  movies = JSON.parse(movies);\r\n  if (!movies.length) {\r\n    movieList.value = [];\r\n    isINITed.value = true;\r\n    return;\r\n  }\r\n\r\n  console.log(\"movies\", movies);\r\n  let promiseArr = [];\r\n  movies.forEach((id) => {\r\n    let p;\r\n    let isNetflix = id.toString().includes(\"n\");\r\n    if (isNetflix) {\r\n      id = id.replace(\"n\", \"\");\r\n      p = apiGetNexflixDetail(id);\r\n    } else {\r\n      p = apiGetMovieDetail(id);\r\n    }\r\n    promiseArr.push(p);\r\n  });\r\n\r\n  Promise.all(promiseArr)\r\n    .then((values) => {\r\n      let result = [];\r\n      values.forEach((v) => {\r\n        result.push(v.data);\r\n      });\r\n\r\n      movieList.value = result.map((d) => {\r\n        let id = d.id;\r\n        let isNetflix = movies.find((_id) => _id.toString().includes(id))\r\n          ? true\r\n          : false;\r\n\r\n        return {\r\n          id: d.id,\r\n          //   url: d.poster_path,\r\n          url: d.backdrop_path, // 改長寬的圖\r\n          title: d.title ? d.title : d.name,\r\n          score: d.vote_average,\r\n          movie: d,\r\n          isNetflix,\r\n        };\r\n      });\r\n      isINITed.value = true;\r\n    })\r\n    .catch(() => {\r\n      isINITed.value = true;\r\n    });\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"myMovies-wrapper\">\r\n    <div class=\"myMovies-wrapper-title\">\r\n      <h3>我的片單</h3>\r\n    </div>\r\n    <div v-if=\"isINITed\">\r\n      <div class=\"movies-content\" ref=\"moviesEl\" v-if=\"movieList.length\">\r\n        <div class=\"movies-list\" :key=\"movie.id\" v-for=\"movie in movieList\">\r\n          <MovieItem :movie=\"movie\" />\r\n        </div>\r\n      </div>\r\n      <div v-else style=\"width: 100%\">\r\n        <h3 style=\"font-size: 24px\">尚未添加電影到我的片單</h3>\r\n      </div>\r\n    </div>\r\n    <div v-else>\r\n      <div class=\"movies-content INITing\">\r\n        <div class=\"movies-list\">\r\n          <SkeletonItem :content-url=\"movieImg\" :keep-loading=\"true\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <MovieModal ref=\"modal\" />\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.myMovies-wrapper {\r\n  min-height: 100vh;\r\n  width: 100%;\r\n  padding: 0 3%;\r\n  @media screen and (max-width: 768px) {\r\n    padding: 0 4%;\r\n  }\r\n}\r\n.myMovies-wrapper-title {\r\n  padding-top: 70px;\r\n  padding-bottom: 70px;\r\n  h3 {\r\n    font-size: 2rem;\r\n  }\r\n  @media screen and (max-width: 800px) {\r\n    padding-bottom: 25px;\r\n    h3 {\r\n      font-size: 1.8rem;\r\n    }\r\n  }\r\n}\r\n.movies-content {\r\n  display: grid;\r\n  grid-template-columns: 16.66665% 16.66665% 16.66665% 16.66665% 16.66665% 16.66665%;\r\n  margin: -5px;\r\n\r\n  @media screen and (max-width: 1400px) {\r\n    grid-template-columns: 20% 20% 20% 20% 20%;\r\n  }\r\n\r\n  @media screen and (max-width: 1100px) {\r\n    grid-template-columns: 25% 25% 25% 25%;\r\n  }\r\n  @media screen and (max-width: 800px) {\r\n    grid-template-columns: 33.33333% 33.33333% 33.33333%;\r\n  }\r\n  @media screen and (max-width: 500px) {\r\n    grid-template-columns: 50% 50%;\r\n  }\r\n\r\n  .movies-list {\r\n    margin: 5px;\r\n    position: relative;\r\n    border-radius: 5px;\r\n    overflow: hidden;\r\n    transition: ease 0.3s;\r\n    margin-bottom: 45px;\r\n\r\n    @media screen and (max-width: 500px) {\r\n      margin-bottom: 35px;\r\n    }\r\n  }\r\n}\r\n\r\n@media screen and (max-width: 480px) {\r\n  .movies-content {\r\n    .movies-list {\r\n      border-radius: 5px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":[],"mappings":"8kBAWA,KAAM,GAAQ,EAAY,EACpB,CAAE,WAAU,YAAa,EAAY,CAAK,EAE1C,EAAY,EAAI,CAAA,CAAE,EAClB,EAAW,EAAI,IAAI,EACnB,EAAW,EAAI,EAAK,EAG1B,EAAM,EAAU,AAAC,GAAM,CACrB,AAAI,GAAK,CAAC,EAAS,OACjB,SAAQ,IAAI,IAAK,CAAC,EAClB,EAAa,EAAE,MAAM,EAEzB,CAAC,EAED,EAAM,EAAU,AAAC,GAAM,CACrB,AAAI,GAAK,EAAS,OAChB,EAAa,CAAC,CAElB,CAAC,EAED,AAAI,EAAS,MAAM,OACjB,EAAa,EAAS,MAAM,MAAM,EAGlC,WAAW,IAAM,CACf,EAAS,MAAQ,EAClB,EAAE,GAAgB,EAGrB,WAAsB,EAAS,GAAI,CACjC,GAAI,CAAC,EAAQ,MAAQ,GAAS,MAAQ,GAGtC,GADA,EAAS,KAAK,MAAM,CAAM,EACtB,CAAC,EAAO,OAAQ,CAClB,EAAU,MAAQ,GAClB,EAAS,MAAQ,GACjB,MACD,CAED,QAAQ,IAAI,SAAU,CAAM,EAC5B,GAAI,GAAa,CAAA,EACjB,EAAO,QAAQ,AAAC,GAAO,CACrB,GAAI,GAEJ,AADgB,EAAG,SAAU,EAAC,SAAS,GAAG,EAExC,GAAK,EAAG,QAAQ,IAAK,EAAE,EACvB,EAAI,EAAoB,CAAE,GAE1B,EAAI,EAAkB,CAAE,EAE1B,EAAW,KAAK,CAAC,CACrB,CAAG,EAED,QAAQ,IAAI,CAAU,EACnB,KAAK,AAAC,GAAW,CAChB,GAAI,GAAS,CAAA,EACb,EAAO,QAAQ,AAAC,GAAM,CACpB,EAAO,KAAK,EAAE,IAAI,CAC1B,CAAO,EAED,EAAU,MAAQ,EAAO,IAAI,AAAC,GAAM,CAClC,GAAI,GAAK,EAAE,GACP,EAAY,IAAO,KAAK,AAAC,GAAQ,EAAI,SAAU,EAAC,SAAS,CAAE,CAAC,EAIhE,MAAO,CACL,GAAI,EAAE,GAEN,IAAK,EAAE,cACP,MAAO,EAAE,MAAQ,EAAE,MAAQ,EAAE,KAC7B,MAAO,EAAE,aACT,MAAO,EACP,WACV,CACA,CAAO,EACD,EAAS,MAAQ,EACvB,CAAK,EACA,MAAM,IAAM,CACX,EAAS,MAAQ,EACvB,CAAK,CACL"}